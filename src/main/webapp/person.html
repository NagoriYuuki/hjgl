<!DOCTYPE html>
<html lang="en">
<head>
    <base href="http://localhost:8080/">
    <meta charset="UTF-8">
    <title>Title123123</title>
<!--    there？-->
    <link rel="stylesheet" href="static/layui/css/layui.css">
</head>
<body>
<table class="layui-table" lay-data="{toolbar:'#toptools', url:'/person/list', page:true, id:'datalist'}" lay-filter="datalist">
    <thead>
    <tr>
<!--        check-->
        <th lay-data="{field:'personid', sort: true}">ID</th>
        <th lay-data="{field:'personname'}">姓名</th>
        <th lay-data="{field:'persongender'}">性别</th>
        <th lay-data="{field:'personbirthday',sort: true}">出生日期</th>
        <th lay-data="{field:'personidcardnumber'}">身份证号</th>
        <th lay-data="{field:'personhouseholdid'}">户籍编号</th>
<!--        <th lay-data="{field:'personhouseholdid', sort: true}">出生日期</th>-->
<!--        <th lay-data="{field:'isdelete', sort: true}">身份证号</th>-->
<!--        <th lay-data="{field:'price', sort: true}">价格</th>-->
<!--        <th lay-data="{templet:function(d){return d.category.categoryname}}">分类</th>-->
        <th lay-data="{toolbar:'#linetools'}">操作</th>
    </tr>
    </thead>
</table>

<!--借阅图书的窗口-->
<div id="borrowWin" lay-filter="borrowWin" class="layui-form" style="display: none">
    <input type="hidden" name="personname">
    <div class="layui-form-item">
        <label class="layui-form-label">书名</label>
        <div class="layui-input-block">
            <input type="text" name="booktitle" placeholder="请输入图书名称" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">借阅人</label>
        <div class="layui-input-block">
            <select name="userid" lay-verify="required" lay-search="">
                <option value="">直接选择或搜索选择</option>
            </select>
        </div>
    </div>
</div>
<!--新增窗口组件-->
<div id="editWin" lay-filter="editWin" class="layui-form" style="display: none">


    <div class="layui-form-item">
        <label class="layui-form-label">姓名</label>
        <div class="layui-input-block">
            <input type="text" name="personname"  placeholder="请输入姓名" autocomplete="off" class="layui-input">
        </div>
    </div>
<!--    <div class="layui-form-item">-->
<!--        <label class="layui-form-label">性别</label>-->
<!--        <div class="layui-input-block">-->
<!--            <select name="categoryid">-->
<!--                <option value="male">男</option>-->
<!--                <option value="female">女</option>-->
<!--            </select>-->
<!--        </div>-->
<!--    </div>-->
    <div class="layui-form-item">
        <label class="layui-form-label">性别</label>
        <div class="layui-input-block">
            <input type="text" name="persongender"  placeholder="请输入性别" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
    <label class="layui-form-label">出生日期</label>
    <div class="layui-input-block">
        <input type="text" name="personbirthday"  placeholder="请输入出生日期" autocomplete="off" class="layui-input">
    </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">身份证号码</label>
        <div class="layui-input-block">
            <input type="text" name="personidcardnumber"  placeholder="请输入身份证号码" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">户籍编号</label>
        <div class="layui-input-block">
            <input type="text" name="personhouseholdid"  placeholder="请输入户籍编号" autocomplete="off" class="layui-input">
        </div>
    </div>

</div>
<!--编辑窗口组件-->
<<div id="addWin" lay-filter="addWin" class="layui-form" style="display: none">


    <div class="layui-form-item">
        <label class="layui-form-label">姓名</label>
        <div class="layui-input-block">
            <input type="text" name="personname"  placeholder="请输入姓名" autocomplete="off" class="layui-input">
        </div>
    </div>
    <!--    <div class="layui-form-item">-->
    <!--        <label class="layui-form-label">性别</label>-->
    <!--        <div class="layui-input-block">-->
    <!--            <select name="categoryid">-->
    <!--                <option value="male">男</option>-->
    <!--                <option value="female">女</option>-->
    <!--            </select>-->
    <!--        </div>-->
    <!--    </div>-->
    <div class="layui-form-item">
        <label class="layui-form-label">性别</label>
        <div class="layui-input-block">
            <input type="text" name="persongender"  placeholder="请输入性别" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">出生日期</label>
        <div class="layui-input-block">
            <input type="text" name="personbirthday"  placeholder="请输入出生日期" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">身份证号码</label>
        <div class="layui-input-block">
            <input type="text" name="personidcardnumber"  placeholder="请输入身份证号码" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">户籍编号</label>
        <div class="layui-input-block">
            <input type="text" name="personhouseholdid"  placeholder="请输入户籍编号" autocomplete="off" class="layui-input">
        </div>
    </div>
    <!--    <div class="layui-form-item">-->
    <!--        <label class="layui-form-label">价格</label>-->
    <!--        <div class="layui-input-block">-->
    <!--            <input type="text" name="price"  placeholder="请输入价格" autocomplete="off" class="layui-input">-->
    <!--        </div>-->
    <!--    </div>-->

</div>
<!--表格头部工具栏-->
<script type="text/html" id="toptools">
    <div class="layui-form-item">
        <div class="layui-input-inline">
            <input type="text" name="checktext"  autocomplete="off" class="layui-input">
        </div>
        <div class="layui-input-inline">
            <button type="button" class="layui-btn layui-btn"
                    lay-event="check">查询</button>
            <button type="button" class="layui-btn layui-btn"
                    lay-event="add">新增</button>
        </div>
    </div>
</script>
<!--表格行内工具栏-->
<script type="text/html" id="linetools">
    <button type="button" class="layui-btn layui-btn-xs layui-bg-orange"
            lay-event="edit">编辑</button>
    <button type="button" class="layui-btn layui-btn-xs layui-bg-red"
            lay-event="delete">删除</button>
    <button type="button" class="layui-btn layui-btn-xs layui-bg-orange"
            lay-event="borrow">借阅</button>
</script>
<script src="static/layui/layui.all.js"></script>
<script>
    /*声明layui内部对象*/
    const $=layui.$;
    const table=layui.table;
    const layer=layui.layer;
    const form=layui.form;
<!--没有登录-->
       $.ajax({
       url:"login/islogin",
       async:false,
       success:function(result){
            if(!result){
                top.location.href="login.html"
            }
       }
       });
<!--   查询数据库中分类的信息  将分类 信息转换成  下拉框选项   设置到2个下拉框中-->
<!--    1. 查询数据库中分类的信息-->
    $.ajax({
    url:'person/list',
    async:false,
    success:function(result){
        var data=result.data;
        for(var index in data){
<!--        2.将分类 信息转换成  下拉框选项 .-->
            $("select[name='categoryid']").append(
            "<option value='"+data[index].categoryid+"'>"+data[index].categoryname+"</option>"
            );
        }
    }
    });


    $.ajax({
        url:'person/list',
        async:false,
        success:function(result){
        var data=result.data;
        for(var index in data){
            $("select[name='personid']").append(
            " <option value='"+data[index].personid+"'> "+data[index].personname+"</option>"
            );
            }
        }
    });

    /*声明表格头部工具栏时间*/
    table.on("toolbar(datalist)",function(obj){
        var event=obj.event;
        if(event=='check'){
<!--        点击查询按钮执行的代码-->
        var checktext=$("[name='checktext']").val();
        table.reload("datalist",{where:{checktext:checktext}});
        $("[name='checktext']").val(checktext);
        }else
        if(event=='add'){
            //点击新增按钮执行的方法
            form.val("addWin",{personname:"",persongender:"",personbirthday:"",personicardnumber:"",personhouseholdid:""});
            //打开一个对话框(输入内容)
            layer.open({
                type:1,
                title:"新增图书",
                area:['470px','500px'],
                content:$("#addWin"),
                btn:["保存"],
                btn1:function(){
                    //点击保存按钮  保存数据
                    //表单中的数据
                    var formdata=form.val("addWin");
                    $.ajax({
                        method:'post',
                        url:'person/add',
                        data:formdata,
                        success:function(result){
                            //关闭对话框
                            layer.closeAll();
                            //刷新数据
                            table.reload("datalist");
                            //提示用户
                            layer.msg("添加成功",{icon:1,time:1800});
                        }
                    });
                }
            });
        }
    });

    /*行内工具栏的监听事件*/
    table.on("tool(datalist)",function(obj){
        var event=obj.event;
        var data=obj.data;//点击按钮所在行的数据
        if(event=='borrow'){
<!--        点击借阅按钮的操作-->
        form.val("borrowWin",data)
        layer.open({
        type:1,
        title:"借阅",
        area:['400px','470px'],
        content:$("#borrowWin"),
        btn:["保存"],
        btn1:function(){
            var formdata=form.val("borrowWin");
            $.ajax({
            url:"borrow/borrow",
            data:formdata,
            success:function(){
          //关闭窗口
        layer.closeAll();
        //提示用户
        layer.msg("保存成功",{icon:1,time:1800});
        }
        });
            }
            });


        }else if(event=='edit'){
            //点击编辑按钮执行的方法
            form.val("editWin",data);//显示原始数据
            //打开对话框
            layer.open({
                type:1,
                title:'编辑人口',
                area:['400px','470px'],
                content:$("#editWin"),
                btn:["保存"],
                btn1:function(){
                    //获取表单数据
                    var formdata=form.val("editWin");
                    //提交数据
                    $.ajax({
                        method:"post",
                        url:"person/edit",
                        data:formdata,
                        success:function(result){
                            //刷新表格
                            table.reload("datalist");
                            //关闭窗口
                            layer.closeAll();
                            //提示用户
                            layer.msg("保存成功",{icon:1,time:1800});
                        }
                    });

                }
            });
        }else if(event=='delete'){
            //点击删除按钮执行的方法
            //确认是否删除数据
            layer.confirm("确认要删除该行数据吗?",function(){
                //点击确认后执行的代码
                $.ajax({
                    url:"person/delete",
                    data:{bookid:data.bookid},
                    success:function (){
                        layer.closeAll();
                        table.reload("datalist");
                        layer.msg("删除成功",{icon:1,time:1800});
                    }
                });
            });
        }
    });
</script>

</body>
</html>